<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canlƒ± Sohbet</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background: #f0f2f5; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        #login-screen { background: #0055ff; color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; position: fixed; width: 100%; z-index: 10; }
        header { background: #0055ff; color: white; padding: 15px; text-align: center; font-weight: bold; position: sticky; top: 0; }
        #chat-box { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { background: white; padding: 10px; border-radius: 10px; max-width: 80%; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .msg b { color: #0055ff; display: block; font-size: 12px; }
        .msg img { max-width: 100%; border-radius: 5px; margin-top: 5px; }
        footer { background: white; padding: 10px; display: flex; gap: 5px; border-top: 1px solid #ddd; }
        input[type="text"] { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 20px; outline: none; }
        .btn-send { background: #0055ff; color: white; border: none; padding: 10px 15px; border-radius: 50%; cursor: pointer; }
    </style>
</head>
<body>

<div id="login-screen">
    <h2>T√ºrkmeneli Sohbet</h2>
    <input type="text" id="username" placeholder="ƒ∞sminizi girin..." style="width: 70%; padding: 12px; border-radius: 8px; border: none;">
    <button onclick="startChat()" style="margin-top: 15px; padding: 10px 30px; border-radius: 8px; border: none; font-weight: bold;">Gƒ∞Rƒ∞≈û</button>
</div>

<header>
    T√úRKMENELƒ∞ <br>
    <small><span id="online-count">0</span> Online</small>
</header>

<div id="chat-box"></div>

<footer>
    <label for="file-input" style="cursor:pointer; padding: 5px;">üìé</label>
    <input type="file" id="file-input" style="display:none" accept="image/*, .pdf, .txt">
    <input type="text" id="msg-input" placeholder="Mesaj yazƒ±n...">
    <button class="btn-send" onclick="send()">‚û§</button>
</footer>

<script>
    const socket = io();
    let myName = "";

    function startChat() {
        const input = document.getElementById('username');
        if(input.value.trim() !== "") {
            myName = input.value;
            document.getElementById('login-screen').style.display = 'none';
        }
    }

    function send() {
        const text = document.getElementById('msg-input').value;
        const fileInput = document.getElementById('file-input');
        const file = fileInput.files[0];

        if(text || file) {
            if(file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    socket.emit('send-msg', { user: myName, text: text, file: e.target.result, fileName: file.name });
                };
                reader.readAsDataURL(file);
            } else {
                socket.emit('send-msg', { user: myName, text: text });
            }
            document.getElementById('msg-input').value = "";
            fileInput.value = "";
        }
    }

    socket.on('new-msg', (data) => {
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');
        div.className = 'msg';
        let fileContent = "";
        if(data.file) {
            if(data.file.includes("image")) {
                fileContent = `<img src="${data.file}">`;
            } else {
                fileContent = `<br><a href="${data.file}" download="${data.fileName}">üìÅ ${data.fileName}</a>`;
            }
        }
        div.innerHTML = `<b>${data.user}</b> ${data.text} ${fileContent}`;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    });

    socket.on('update-online', (count) => {
        document.getElementById('online-count').innerText = count;
    });
</script>
</body>
</html>
